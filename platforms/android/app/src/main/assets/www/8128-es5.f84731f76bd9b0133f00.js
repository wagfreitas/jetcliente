!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkdriver=self.webpackChunkdriver||[]).push([[8128],{8128:function(t,i,o){"use strict";o.r(i),o.d(i,{TrackingPageModule:function(){return k}});var r=o(8583),a=o(3679),l=o(2859),s=o(3025),c=o(9019),g=o(5257),p=o(3465),u=o(7716),d=o(4050),h=o(9997),v=o(7234),m=o(7318),f=o(4207),Z=o(5469);function T(e,t){if(1&e){var n=u.EpF();u.TgZ(0,"ion-button",13),u.NdJ("click",function(){return u.CHM(n),u.oxw().cancelTrip()}),u._uU(1),u.ALo(2,"translate"),u.qZA()}2&e&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"CANCEL_TRIP")," "))}function A(e,t){if(1&e&&(u.TgZ(0,"ion-button",14),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&e){var n=u.oxw();u.MGl("href","tel:",n.settings.sos,""),u.xp6(1),u.hij("",u.lcZ(2,2,"SOS")," ")}}var b,w,q=[{path:"",component:(b=function(){function t(n,i,o,r,a,l,s,c,g){var p=this;e(this,t),this.driverService=n,this.tripService=i,this.placeService=o,this.router=r,this.menuCtrl=a,this.afdb=l,this.alertCtrl=s,this.modalCtrl=c,this.ss=g,this.trip={},this.alertCnt=0,this.rate=5,this.distanceText="-",this.durationText="-",this.settings={},this.ss.getSettings().subscribe(function(e){return p.settings=null!=e?e.payload.val():{}})}return n(t,[{key:"ngOnInit",value:function(){}},{key:"ionViewDidEnter",value:function(){var e=this;this.menuCtrl.enable(!0);var t=this.tripService.getId();this.dbRef=this.tripService.getTrip(t).valueChanges().subscribe(function(t){null!=t&&(console.log(e.trip),e.trip=t,console.log(e.trip),e.trip.status==c.zb?(clearInterval(e.driverTracking),e.dbRef.unsubscribe(),e.router.navigateByUrl("/home",{skipLocationChange:!0,replaceUrl:!0})):e.trip.status==c.gP&&(clearInterval(e.driverTracking),e.dbRef.unsubscribe(),e.router.navigateByUrl("/home",{skipLocationChange:!0,replaceUrl:!0}),e.modalCtrl.create({component:p.L,componentProps:{trip:e.trip,driver:e.driver}}).then(function(e){return e.present()})),e.loadMap())})}},{key:"ionViewDidLeave",value:function(){console.log("ionViewDidLeave()"),clearInterval(this.driverTracking),this.dbRef.unsubscribe()}},{key:"loadMap",value:function(){var e=this;console.log("load Map calling");var t,n=new google.maps.LatLng(this.trip.origin.location.lat,this.trip.origin.location.lng),i=c.NZ.mapOptions;i.mapTypeId=google.maps.MapTypeId.ROADMAP,i.center=n,this.map=new google.maps.Map(document.getElementById("map"),i),this.marker=new google.maps.Marker({map:this.map,position:n,icon:{url:"assets/img/map-suv.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,16),scaledSize:new google.maps.Size(32,32)}});var o=new google.maps.DirectionsService;(t=new google.maps.DirectionsRenderer({polylineOptions:{strokeColor:"black"}})).setMap(this.map);var r={origin:new google.maps.LatLng(this.trip.origin.location.lat,this.trip.origin.location.lng),destination:new google.maps.LatLng(this.trip.destination.location.lat,this.trip.destination.location.lng),travelMode:google.maps.TravelMode.DRIVING};o.route(r,function(e,n){n==google.maps.DirectionsStatus.OK?(console.log(e),t.setDirections(e),t.setMap(this.map)):console.log("error")}),this.driverTracking=setInterval(function(){e.driverService.getDriver(e.trip.driverId).valueChanges().pipe((0,g.q)(1)).subscribe(function(t){e.driver=t,console.log(e.driver),e.showDriverOnMap(e.driver.lat,e.driver.lng)})},c.YL)}},{key:"range",value:function(e){return new Array(Math.round(e))}},{key:"cancelTrip",value:function(){var e=this;this.alertCtrl.create({message:"Are you sure want to cancel the trip",buttons:[{text:"Yes",handler:function(){e.tripService.cancelTrip(e.trip.key).then(function(e){console.log(e)})}},{text:"No"}]}).then(function(e){return e.present()})}},{key:"showDriverOnMap",value:function(e,t){var n=this;this.marker.setMap(null);var i=new google.maps.LatLng(e,t);this.trip.status==c.MA&&this.map.setCenter(i),this.marker=new google.maps.Marker({map:this.map,position:i,icon:{url:"assets/img/map-suv.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,16),scaledSize:new google.maps.Size(32,32)}});var o,r=new google.maps.DirectionsService;o="waiting"==this.trip.status?{origin:i,destination:new google.maps.LatLng(this.trip.origin.location.lat,this.trip.origin.location.lng),travelMode:google.maps.TravelMode.DRIVING}:{origin:i,destination:new google.maps.LatLng(this.trip.destination.location.lat,this.trip.destination.location.lng),travelMode:google.maps.TravelMode.DRIVING},r.route(o,function(e,t){t==google.maps.DirectionsStatus.OK?(console.log(e),n.distanceText=e.routes[0].legs[0].distance.text,n.durationText=e.routes[0].legs[0].duration.text):console.log("error")})}}]),t}(),b.\u0275fac=function(e){return new(e||b)(u.Y36(d.F),u.Y36(h.a),u.Y36(v.k),u.Y36(s.F0),u.Y36(l._q),u.Y36(m.KQ),u.Y36(l.Br),u.Y36(l.IN),u.Y36(f.R))},b.\u0275cmp=u.Xpm({type:b,selectors:[["app-tracking"]],decls:55,vars:35,consts:[["color","dark"],["slot","end"],["color","danger","fill","solid","size","small",3,"click",4,"ngIf"],["fill","solid","color","danger",3,"href",4,"ngIf"],["id","map",2,"height","100%"],[2,"text-align","right","color","#222"],[2,"background","#ffff00"],["lines","none"],["slot","start"],["onerror","this.src='./assets/img/default.png'",3,"src"],["name","star","color","yellow"],["color","dark","slot","end",3,"href"],["name","call"],["color","danger","fill","solid","size","small",3,"click"],["fill","solid","color","danger",3,"href"]],template:function(e,t){1&e&&(u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar",0),u.TgZ(2,"ion-title"),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"ion-buttons",1),u.YNc(6,T,3,3,"ion-button",2),u.YNc(7,A,3,4,"ion-button",3),u.qZA(),u.qZA(),u.qZA(),u.TgZ(8,"ion-content"),u._UZ(9,"div",4),u.TgZ(10,"ion-card"),u.TgZ(11,"div",5),u.TgZ(12,"span",6),u._uU(13),u.ALo(14,"translate"),u.qZA(),u.qZA(),u.TgZ(15,"ion-item",7),u.TgZ(16,"ion-avatar",8),u._UZ(17,"img",9),u.qZA(),u.TgZ(18,"ion-label"),u.TgZ(19,"ion-text"),u.TgZ(20,"h2"),u._uU(21),u._UZ(22,"ion-icon",10),u.qZA(),u.qZA(),u.TgZ(23,"ion-text"),u.TgZ(24,"p"),u._uU(25),u.qZA(),u.qZA(),u.qZA(),u.TgZ(26,"ion-button",11),u._UZ(27,"ion-icon",12),u._uU(28),u.ALo(29,"translate"),u.qZA(),u.qZA(),u.TgZ(30,"ion-row"),u.TgZ(31,"ion-col"),u.TgZ(32,"p"),u._uU(33),u.ALo(34,"translate"),u.qZA(),u.TgZ(35,"h5"),u._uU(36),u.qZA(),u.qZA(),u.TgZ(37,"ion-col"),u.TgZ(38,"p"),u._uU(39),u.ALo(40,"translate"),u.qZA(),u.TgZ(41,"h5"),u._uU(42),u.qZA(),u.qZA(),u.TgZ(43,"ion-col"),u.TgZ(44,"p"),u._uU(45),u.ALo(46,"translate"),u.qZA(),u.TgZ(47,"h5"),u._uU(48),u.qZA(),u.qZA(),u.TgZ(49,"ion-col"),u.TgZ(50,"p"),u._uU(51),u.ALo(52,"translate"),u.qZA(),u.TgZ(53,"h5"),u._uU(54),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&e&&(u.xp6(3),u.Oqu(u.lcZ(4,21,"ON_THE_WAY")),u.xp6(3),u.Q6J("ngIf","waiting"==t.trip.status),u.xp6(1),u.Q6J("ngIf","going"==t.trip.status),u.xp6(6),u.AsE("",u.lcZ(14,23,"OTP"),": ",null==t.trip?null:t.trip.otp,""),u.xp6(4),u.s9C("src",null==t.driver?null:t.driver.photoURL,u.LSH),u.xp6(4),u.AsE("",null==t.driver?null:t.driver.name," \xa0 ",null==t.driver?null:t.driver.rating," "),u.xp6(4),u.AsE("",null==t.driver?null:t.driver.plate," \xb7 ",null==t.driver?null:t.driver.brand,""),u.xp6(1),u.MGl("href","tel: ",null==t.driver?null:t.driver.phoneNumber," "),u.xp6(2),u.hij("\xa0",u.lcZ(29,25,"CALL")," "),u.xp6(5),u.Oqu(u.lcZ(34,27,"DISTANCE")),u.xp6(3),u.Oqu(t.distanceText),u.xp6(3),u.Oqu(u.lcZ(40,29,"ETA")),u.xp6(3),u.Oqu(t.durationText),u.xp6(3),u.Oqu(u.lcZ(46,31,"PRICE")),u.xp6(3),u.AsE("",t.trip.currency," ",t.trip.fee,""),u.xp6(3),u.Oqu(u.lcZ(52,33,"PAYMENT")),u.xp6(3),u.Oqu(t.trip.paymentMethod))},directives:[l.Gu,l.sr,l.wd,l.Sm,r.O5,l.W2,l.PM,l.Ie,l.BJ,l.Q$,l.yW,l.gu,l.YG,l.Nd,l.wI],pipes:[Z.X$],styles:["h5[_ngcontent-%COMP%], ion-col[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;text-align:center}ion-col[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:16px;color:#333}ion-card[_ngcontent-%COMP%]{position:absolute;z-index:999999;background:#fff;bottom:0;left:0;right:0;padding:8px}.footer-md[_ngcontent-%COMP%]:before{background-image:none!important}"]}),b)}],x=function(){var t=n(function t(){e(this,t)});return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[s.Bz.forChild(q)],s.Bz]}),t}(),k=((w=n(function t(){e(this,t)})).\u0275fac=function(e){return new(e||w)},w.\u0275mod=u.oAB({type:w}),w.\u0275inj=u.cJS({imports:[[r.ez,a.u5,l.Pc,Z.aw,x]]}),w)}}])}();