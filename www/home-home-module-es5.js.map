{"version":3,"sources":["webpack:///src/app/home/home.page.html","webpack:///src/app/home/home-routing.module.ts","webpack:///src/app/home/home.module.ts","webpack:///src/app/home/home.page.scss","webpack:///src/app/home/home.page.ts","webpack:///src/app/services/deal.service.ts"],"names":["routes","path","component","HomePageRoutingModule","imports","forChild","exports","HomePageModule","declarations","HomePage","router","alertCtrl","placeService","geolocation","chRef","settingService","tripService","driverService","afAuth","authService","translate","dealService","common","menuCtrl","db","mapId","Math","random","mapHeight","showModalBg","showVehicles","vehicles","note","promocode","distance","duration","paymentMethod","activeDrivers","driverMarkers","locateDriver","user","isTrackDriverEnabled","discount","settings","distanceText","durationText","enable","authState","subscribe","authData","getUser","uid","snapshotChanges","snap","key","payload","val","getSettings","res","origin","getOrigin","destination","getDestination","loadMap","clearInterval","driverTracking","getPaymentMethod","create","header","inputs","type","label","value","buttons","text","handler","data","console","log","getCardSetting","valueChanges","pipe","setPaymentMethod","exp","split","Stripe","card","createToken","number","exp_month","exp_year","cvc","cvv","status","response","updateCardSetting","id","showToast","error","message","showAlert","then","present","index","i","length","active","setVehicle","currentVehicle","trackDrivers","toggleVehicles","getCurrentPosition","resp","startLatLng","google","maps","LatLng","location","lat","lng","coords","latitude","longitude","directionsDisplay","directionsService","DirectionsService","DirectionsRenderer","polylineOptions","strokeColor","mapOptions","center","mapTypeId","MapTypeId","ROADMAP","map","Map","document","getElementById","mapx","setMap","geocoder","Geocoder","geocode","getCenter","results","GeocoderStatus","OK","formatAddress","setOrigin","vicinity","detectChanges","locality","setLocalityFromGeocoder","getPrices","snapshot","obj","currency","setCurrency","Object","keys","forEach","push","route","request","result","DirectionsStatus","legs","parseInt","base_km","fee","parseFloat","base_fare","toFixed","fee_taxed","tax","extraKm","per_km","commission_type","commission","commission_value","destLatLng","bounds","LatLngBounds","extend","fitBounds","travelMode","TravelMode","DRIVING","setDirections","name","placeholder","code","toUpperCase","list","ref","orderByChild","equalTo","promocodes","promo","setPromo","setDiscount","prompt","setNote","setAvailableDrivers","setDistance","setFee","setRawFee","setFeeTaxed","setIcon","icon","setTax","setCommissionType","setCommissionValue","setCommission","drivers","getAvailableDrivers","sortDriversList","getDiscount","getFee","feeAfterDiscount","feeTaxedAfterDiscount","getTax","makeDeal","driver","dealAccepted","getDriverDeal","getDistance","getCurrency","getNote","getPromo","getFeeTaxed","getRawFee","getCommissionType","getCommissionValue","getCommission","sub","unsubscribe","nextDriver","tripId","setId","navigateByUrl","splice","navigate","queryParams","latLng","startMarker","Marker","position","setCenter","showDriverOnMap","setInterval","getActiveDriver","clearDrivers","vehicle","calcCrow","last_active","Date","now","marker","url","map_icon","size","Size","Point","anchor","scaledSize","selector","template","DealService","sort","a","b","rating","userId","driverId","rawfee","object","set","passengerId","createdAt","remove","providedIn"],"mappings":"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","file":"home-home-module-es5.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar color=\\\"dark\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button></ion-menu-button>\\n    </ion-buttons>\\n    <ion-title>\\n     JetPort\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n<ion-content>\\n  <div class=\\\"locationinput-holder\\\">\\n    <input class=\\\"locationinput\\\" (click)=\\\"chooseOrigin()\\\" placeholder=\\\"local do atendimento?\\\" type=\\\"text\\\"\\n      value=\\\"{{origin ? origin.vicinity : '' }}\\\">\\n    <!--input class=\\\"locationinput\\\" (click)=\\\"chooseDestination()\\\" placeholder=\\\"Where do you want to drop?\\\" type=\\\"text\\\"\\n      value=\\\"{{ destination ? destination.vicinity : '' }}\\\"-->\\n    <p class=\\\"distanceText\\\" [hidden]=\\\"!destination\\\">\\n      <span *ngIf=\\\"distanceText!=''\\\">{{ distanceText }}</span>\\n      <span *ngIf=\\\"durationText!=''\\\">&nbsp; {{durationText}}</span>\\n    </p>\\n  </div>\\n\\n  <div id=\\\"{{ mapId }}\\\" [ngStyle]=\\\"{height: '100%'}\\\"></div>\\n</ion-content>\\n<ion-footer>\\n  <ion-toolbar style=\\\"padding: 8px;\\\">\\n    <ion-row [hidden]=\\\"!destination\\\" style=\\\"background: #f5f5f5;\\\">\\n      <ion-col>\\n        <ion-button fill=\\\"clear\\\" size=\\\"small\\\" color=\\\"dark\\\" expand=\\\"block\\\" (click)=\\\"choosePaymentMethod1()\\\">\\n          <ion-icon slot=\\\"start\\\" name=\\\"{{ getPaymentMethod() }}\\\"></ion-icon>\\n          {{ getPaymentMethod() }}\\n        </ion-button>\\n      </ion-col>\\n      <ion-col>\\n        <ion-button fill=\\\"clear\\\" size=\\\"small\\\" color=\\\"dark\\\" expand=\\\"block\\\" (click)=\\\"showPromoPopup()\\\">\\n          <ion-icon slot=\\\"start\\\" name=\\\"create\\\"></ion-icon>\\n          {{'PROMO' | translate}}\\n        </ion-button>\\n      </ion-col>\\n    </ion-row>\\n\\n    <ion-row [hidden]=\\\"!destination\\\">\\n\\n      <ion-col *ngFor=\\\"let vehicle of vehicles; let i = index\\\" [ngClass]=\\\"{'active': vehicle.active}\\\"\\n        (click)=\\\"chooseVehicle(i)\\\">\\n        <p class=\\\"carName\\\">{{ vehicle.name }}</p>\\n        <img src=\\\"{{ vehicle.icon }}\\\">\\n        <!-- <p class=\\\"carSeats\\\">{{ vehicle.seats }} seats</p> -->\\n        <p class=\\\"carPrice\\\">{{currency }}{{ vehicle.fee_taxed }}</p>\\n      </ion-col>\\n\\n    </ion-row>\\n\\n\\n    <ion-button expand=\\\"block\\\" color=\\\"dark\\\" [hidden]=\\\"origin\\\" (click)=\\\"chooseDestination()\\\">\\n     Acionar Técnico</ion-button>\\n    <ion-button expand=\\\"block\\\" color=\\\"dark\\\" [hidden]=\\\"!origin\\\" (click)=\\\"book()\\\">\\n      {{ locateDriver == false ? 'Acionar Técnico':'Localizando Técnico'}} <ion-spinner name=\\\"dots\\\" color=\\\"light\\\"\\n        [hidden]=\\\"!locateDriver\\\"></ion-spinner>\\n    </ion-button>\\n  </ion-toolbar>\\n</ion-footer>\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { HomePage } from './home.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: HomePage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class HomePageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { HomePageRoutingModule } from './home-routing.module';\n\nimport { HomePage } from './home.page';\nimport { TranslateModule } from '@ngx-translate/core';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    TranslateModule,\n    HomePageRoutingModule\n  ],\n  declarations: [HomePage]\n})\nexport class HomePageModule {}\n","export default \"ion-title {\\n  text-align: center;\\n  margin-left: -40px !important;\\n  letter-spacing: 4px;\\n}\\n\\n.header-md:after {\\n  background: none;\\n}\\n\\n.locationinput-holder {\\n  padding: 0.2rem 1rem;\\n  background: #222222;\\n  top: 0;\\n  width: 100%;\\n}\\n\\n.locationinput {\\n  background: #fff;\\n  outline: 0;\\n  width: 100%;\\n  padding: 0.5rem;\\n  margin: 2px 0px;\\n  font-size: 14px;\\n  border-radius: 4px;\\n  border: none;\\n  color: #555;\\n}\\n\\n.distanceText {\\n  font-size: 12px;\\n  color: #eeeeee;\\n  margin: 0;\\n}\\n\\n.align-bottom {\\n  position: fixed;\\n  bottom: 0;\\n  width: 100%;\\n  padding: 5px;\\n}\\n\\n.align-bottom p {\\n  font-size: 14p;\\n}\\n\\nion-col {\\n  text-align: center;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  align-items: center;\\n}\\n\\nion-col img {\\n  width: 40px;\\n  height: 40px;\\n  padding: 4px;\\n  border-radius: 100%;\\n}\\n\\nion-col p {\\n  margin: 2px;\\n}\\n\\nion-row {\\n  background: #fff;\\n}\\n\\n.list-md {\\n  margin: -1px 0 0px;\\n}\\n\\n.label-md {\\n  margin: 13px -50px 13px 0;\\n}\\n\\n.text-input-md {\\n  font-size: 14px;\\n  margin: 8px 5px;\\n}\\n\\n#map {\\n  width: 100%;\\n}\\n\\n.active img {\\n  border: 3px solid #ffce00;\\n}\\n\\n.carName {\\n  font-size: 12px;\\n  display: inline-block;\\n  background: #333;\\n  color: #fff;\\n  padding: 2px 4px;\\n  border-radius: 4px;\\n}\\n\\n.carSeats {\\n  color: #777;\\n  font-size: 0.7em;\\n}\\n\\n.carPrice {\\n  color: #777;\\n  font-size: 0.8em;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvaG9tZS9ob21lLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLGtCQUFBO0VBQ0EsNkJBQUE7RUFDQSxtQkFBQTtBQUNKOztBQUNFO0VBQ0UsZ0JBQUE7QUFFSjs7QUFBRTtFQUNFLG9CQUFBO0VBQ0EsbUJBQUE7RUFDQSxNQUFBO0VBQ0EsV0FBQTtBQUdKOztBQURFO0VBQ0UsZ0JBQUE7RUFDQSxVQUFBO0VBQ0EsV0FBQTtFQUNBLGVBQUE7RUFDQSxlQUFBO0VBQ0EsZUFBQTtFQUNBLGtCQUFBO0VBQ0EsWUFBQTtFQUNBLFdBQUE7QUFJSjs7QUFERTtFQUNFLGVBQUE7RUFDQSxjQUFBO0VBQ0EsU0FBQTtBQUlKOztBQUZFO0VBQ0UsZUFBQTtFQUNBLFNBQUE7RUFDQSxXQUFBO0VBQ0EsWUFBQTtBQUtKOztBQUZFO0VBQ0UsY0FBQTtBQUtKOztBQUZFO0VBQ0Usa0JBQUE7RUFDQSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSx1QkFBQTtFQUNBLG1CQUFBO0FBS0o7O0FBSEU7RUFDRSxXQUFBO0VBQ0EsWUFBQTtFQUNBLFlBQUE7RUFDQSxtQkFBQTtBQU1KOztBQUpFO0VBQVksV0FBQTtBQVFkOztBQVBFO0VBQ0UsZ0JBQUE7QUFVSjs7QUFSRTtFQUNFLGtCQUFBO0FBV0o7O0FBVEU7RUFDRSx5QkFBQTtBQVlKOztBQVZFO0VBQ0UsZUFBQTtFQUNBLGVBQUE7QUFhSjs7QUFYRTtFQUNFLFdBQUE7QUFjSjs7QUFYRTtFQUNFLHlCQUFBO0FBY0o7O0FBWEU7RUFDRSxlQUFBO0VBQ0EscUJBQUE7RUFDQSxnQkFBQTtFQUNBLFdBQUE7RUFDQSxnQkFBQTtFQUNBLGtCQUFBO0FBY0o7O0FBWkU7RUFDRSxXQUFBO0VBQ0EsZ0JBQUE7QUFlSjs7QUFiRTtFQUNFLFdBQUE7RUFDQSxnQkFBQTtBQWdCSiIsImZpbGUiOiJzcmMvYXBwL2hvbWUvaG9tZS5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyJpb24tdGl0bGV7XG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIG1hcmdpbi1sZWZ0OiAtNDBweCAhaW1wb3J0YW50O1xuICAgIGxldHRlci1zcGFjaW5nOiA0cHg7XG4gIH1cbiAgLmhlYWRlci1tZDphZnRlcntcbiAgICBiYWNrZ3JvdW5kOiBub25lO1xuICB9XG4gIC5sb2NhdGlvbmlucHV0LWhvbGRlcntcbiAgICBwYWRkaW5nOiAwLjJyZW0gMXJlbTtcbiAgICBiYWNrZ3JvdW5kOiAjMjIyMjIyO1xuICAgIHRvcDowO1xuICAgIHdpZHRoOjEwMCU7XG4gIH1cbiAgLmxvY2F0aW9uaW5wdXR7XG4gICAgYmFja2dyb3VuZDogI2ZmZjtcbiAgICBvdXRsaW5lOjA7XG4gICAgd2lkdGg6IDEwMCU7XG4gICAgcGFkZGluZzogMC41cmVtO1xuICAgIG1hcmdpbjogMnB4IDBweDtcbiAgICBmb250LXNpemU6IDE0cHg7XG4gICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgIGJvcmRlcjogbm9uZTtcbiAgICBjb2xvcjogIzU1NTtcbiAgfVxuICBcbiAgLmRpc3RhbmNlVGV4dHtcbiAgICBmb250LXNpemU6IDEycHg7XG4gICAgY29sb3I6ICNlZWVlZWU7XG4gICAgbWFyZ2luOiAwO1xuICB9XG4gIC5hbGlnbi1ib3R0b20ge1xuICAgIHBvc2l0aW9uOiBmaXhlZDtcbiAgICBib3R0b206IDA7XG4gICAgd2lkdGg6IDEwMCU7XG4gICAgcGFkZGluZzogNXB4O1xuICB9XG4gIFxuICAuYWxpZ24tYm90dG9tIHB7XG4gICAgZm9udC1zaXplOiAxNHBcbiAgfVxuICBcbiAgaW9uLWNvbHtcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIH1cbiAgaW9uLWNvbCBpbWd7XG4gICAgd2lkdGg6IDQwcHg7XG4gICAgaGVpZ2h0OiA0MHB4O1xuICAgIHBhZGRpbmc6IDRweDtcbiAgICBib3JkZXItcmFkaXVzOiAxMDAlO1xuICB9XG4gIGlvbi1jb2wgcCB7IG1hcmdpbjogMnB4IH1cbiAgaW9uLXJvd3tcbiAgICBiYWNrZ3JvdW5kOiAjZmZmO1xuICB9XG4gIC5saXN0LW1kIHtcbiAgICBtYXJnaW46IC0xcHggMCAwcHg7XG4gIH1cbiAgLmxhYmVsLW1ke1xuICAgIG1hcmdpbjogMTNweCAtNTBweCAxM3B4IDA7XG4gIH1cbiAgLnRleHQtaW5wdXQtbWR7XG4gICAgZm9udC1zaXplOiAxNHB4O1xuICAgIG1hcmdpbjogOHB4IDVweDtcbiAgfVxuICAjbWFwIHtcbiAgICB3aWR0aDogMTAwJTtcbiAgfVxuICBcbiAgLmFjdGl2ZSBpbWd7XG4gICAgYm9yZGVyOiAzcHggc29saWQgI2ZmY2UwMDtcbiAgfVxuICBcbiAgLmNhck5hbWV7XG4gICAgZm9udC1zaXplOiAxMnB4O1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICBiYWNrZ3JvdW5kOiAjMzMzO1xuICAgIGNvbG9yOiAjZmZmO1xuICAgIHBhZGRpbmc6IDJweCA0cHg7XG4gICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICB9XG4gIC5jYXJTZWF0c3tcbiAgICBjb2xvcjogIzc3NztcbiAgICBmb250LXNpemU6IDAuN2VtO1xuICB9XG4gIC5jYXJQcmljZXtcbiAgICBjb2xvcjogIzc3NztcbiAgICBmb250LXNpemU6IDAuOGVtO1xuICB9Il19 */\";","import { Component, ChangeDetectorRef, OnInit } from '@angular/core';\nimport { PlaceService } from '../services/place.service';\nimport { SettingService } from '../services/setting.service';\nimport { TranslateService } from '@ngx-translate/core';\nimport { AuthService } from '../services/auth.service';\nimport { DealService } from '../services/deal.service';\nimport { DriverService } from '../services/driver.service';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { TripService } from '../services/trip.service';\nimport { AlertController, MenuController } from '@ionic/angular';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport { Router } from '@angular/router';\nimport { DEAL_STATUS_PENDING, DEAL_STATUS_ACCEPTED, POSITION_INTERVAL, SHOW_VEHICLES_WITHIN, VEHICLE_LAST_ACTIVE_LIMIT, environment } from 'src/environments/environment.prod';\nimport { take } from 'rxjs/operators';\nimport { CommonService } from '../services/common.service';\nimport * as firebase from 'firebase';\nimport { AngularFireDatabase } from '@angular/fire/database';\n\ndeclare var google: any;\ndeclare var Stripe: any;\n\n@Component({\n  selector: 'app-home',\n  templateUrl: 'home.page.html',\n  styleUrls: ['home.page.scss'],\n})\nexport class HomePage implements OnInit {\n\n  mapId = Math.random() + 'map';\n  mapHeight: number = 480;\n  showModalBg: boolean = false;\n  showVehicles: boolean = false;\n  vehicles: any = [];\n  currentVehicle: any;\n  note: any = '';\n  promocode: any = '';\n  map: any;\n  origin: any;\n  destination: any;\n  distance: number = 0;\n  duration: number = 0;\n  currency: string;\n  locality: any;\n  paymentMethod: string = 'dinheiro';\n  activeDrivers: Array<any> = [];\n  driverMarkers: Array<any> = [];\n  driverTracking: any;\n  locateDriver: any = false;\n  drivers: any;\n  user: any = {};\n  isTrackDriverEnabled = true;\n  discount: any = 0;\n  startLatLng: any;\n  destLatLng: any;\n  directionsService: any;\n  directionsDisplay: any;\n  bounds: any;\n  cardNumber: any;\n  settings: any = {};\n\n  distanceText: any = '';\n  durationText: any = '';\n\n  constructor(\n    private router: Router,\n    private alertCtrl: AlertController,\n    private placeService: PlaceService,\n    private geolocation: Geolocation,\n    private chRef: ChangeDetectorRef,\n    private settingService: SettingService,\n    private tripService: TripService,\n    private driverService: DriverService,\n    private afAuth: AngularFireAuth,\n    private authService: AuthService,\n    private translate: TranslateService,\n    private dealService: DealService,\n    private common: CommonService,\n    private menuCtrl: MenuController,\n    private db: AngularFireDatabase\n  ) {\n\n  }\n  ionViewDidEnter() {\n    this.menuCtrl.enable(true);\n    this.afAuth.authState.subscribe(authData => {\n      if (authData != null)\n        this.authService.getUser(authData.uid).snapshotChanges().subscribe((snap: any) => {\n          this.user = { key: snap.key, uid: snap.key, ...snap.payload.val() };\n          //console.log('usuario', this.user);\n        })\n    });\n    this.settingService.getSettings().subscribe(res => res != null ? this.settings = res.payload.val() : this.settings = {});\n\n   // console.log(\"calling\",);\n    this.origin = this.tripService.getOrigin();\n    this.destination = this.tripService.getDestination();\n    this.loadMap();\n  }\n\n  ngOnInit() {\n   // console.log(\"calling\");\n  }\n\n  ionViewDidLeave() {\n    clearInterval(this.driverTracking);\n  }\n\n  // get current payment method from service\n  getPaymentMethod() {\n    this.paymentMethod = this.tripService.getPaymentMethod()\n    return this.paymentMethod;\n  }\n\n  choosePaymentMethod1() {\n    this.alertCtrl.create({\n      header: \"Selecione a forma de pagamento\",\n      inputs: [\n        { type: 'radio', label: \"Card\", value: 'card' }\n      ],\n      buttons: [{\n        text: \"Cancela\"\n      }, {\n        text: \"Seleciona\",\n        handler: (data) => {\n          console.log(data);\n          if (data == 'card') {\n            this.authService.getCardSetting(this.user.uid).valueChanges().pipe(take(1)).subscribe((res: any) => {\n              if (res != null) {\n                this.tripService.setPaymentMethod(data);\n                this.paymentMethod = data;\n\n                const exp = res.exp.split('/');\n                Stripe.card.createToken({\n                  number: res.number,\n                  exp_month: exp[0],\n                  exp_year: exp[1],\n                  cvc: res.cvv\n                }, (status: number, response: any) => {\n                  if (status == 200) {\n                    console.log(\"Card Ready\")\n                    this.authService.updateCardSetting(res.number, res.exp, res.cvv, response.id, this.user.uid);\n                  } else {\n                    this.common.showToast(response.error.message);\n                  }\n                });\n              }\n              else\n                this.common.showAlert(\"Cartão Inválido\")\n            })\n          }\n          else if (data == 'cash') {\n            this.paymentMethod = data;\n            this.tripService.setPaymentMethod(data);\n          }\n        }\n      }]\n    }).then(res => res.present());\n  }\n\n  // toggle active vehicle\n  chooseVehicle(index) {\n    for (var i = 0; i < this.vehicles.length; i++) {\n      this.vehicles[i].active = (i == index);\n      // choose this vehicle type\n      if (i == index) {\n        this.tripService.setVehicle(this.vehicles[i]);\n        this.currentVehicle = this.vehicles[i];\n      }\n    }\n    // start tracking new driver type\n    this.trackDrivers();\n    this.toggleVehicles();\n  }\n\n  loadMap() {\n    // this.common.showLoader(\"Loading..\");\n\n    // busca a localização corrente do cliente\n    return this.geolocation.getCurrentPosition().then((resp) => {\n\n      if (this.origin) this.startLatLng = new google.maps.LatLng(this.origin.location.lat, this.origin.location.lng);\n      else this.startLatLng = new google.maps.LatLng(resp.coords.latitude, resp.coords.longitude);\n\n      let directionsDisplay;\n      let directionsService = new google.maps.DirectionsService();\n      directionsDisplay = new google.maps.DirectionsRenderer({\n        polylineOptions: {\n          strokeColor: \"black\"\n        }\n      });\n\n      var mapOptions: any = environment.mapOptions;\n      mapOptions.center = this.startLatLng;\n      mapOptions.mapTypeId = google.maps.MapTypeId.ROADMAP;\n\n      this.map = new google.maps.Map(document.getElementById(this.mapId), mapOptions);\n\n      let mapx = this.map;\n      directionsDisplay.setMap(mapx);\n\n      // encontra o endereço no mapa\n      let geocoder = new google.maps.Geocoder();\n      geocoder.geocode({ 'latLng': this.map.getCenter() }, (results, status) => {\n        if (status == google.maps.GeocoderStatus.OK) {\n          if (!this.origin) {\n            // atribui o centro do mapa como a origin\n            this.origin = this.placeService.formatAddress(results[0]);\n            this.tripService.setOrigin(this.origin.vicinity, this.origin.location.lat, this.origin.location.lng);\n            this.setOrigin();\n            this.chRef.detectChanges();\n          } else {\n            this.setOrigin();\n          }\n\n          // salva a cidade\n          let locality = this.placeService.setLocalityFromGeocoder(results);\n         // console.log('cidade', locality);\n          // carrega a lista de veiculos e veiculos por cidades\n          this.settingService.getPrices().valueChanges().subscribe((snapshot: any) => {\n            this.vehicles = [];\n           // console.log('veiculos', snapshot);\n            let obj = snapshot[locality] ? snapshot[locality] : snapshot.default;\n          // console.log('objetos', obj)\n            this.currency = this.settings.currency;\n            this.tripService.setCurrency(this.settings.currency);\n\n            // calculate price\n            Object.keys(obj.vehicles).forEach(id => {\n              obj.vehicles[id].id = id;\n              this.vehicles.push(obj.vehicles[id]);\n            });\n\n            console.log('veiculos', this.vehicles);\n\n            // calculate distance between origin adn destination\n            if (this.destination) {\n\n              directionsService.route(request, (result, status) => {\n\n                if (status == google.maps.DirectionsStatus.OK && result.routes.length != 0) {\n                  console.log(result);\n                  this.distance = result.routes[0].legs[0].distance.value / 1000;\n                  this.distanceText = result.routes[0].legs[0].distance.text;\n                  this.durationText = result.routes[0].legs[0].duration.text;\n                  console.log(this.distance);\n\n                  for (let i = 0; i < this.vehicles.length; i++) {\n\n                    // Calculating base fare if distance between base km\n                    if (this.distance <= parseInt(this.vehicles[i].base_km)) {\n                      let fee = parseFloat((this.distance * parseInt(this.vehicles[i].base_fare)).toFixed(2));\n                      this.vehicles[i].fee = fee;\n                      this.vehicles[i].fee_taxed = parseFloat((fee + (fee * (parseInt(this.vehicles[i].tax) / 100))).toFixed(2))\n                    }\n\n                    // Calculating base fare if distance above base km\n                    else if (this.distance > parseInt(this.vehicles[i].base_km)) {\n                      let extraKm = this.distance - parseInt(this.vehicles[i].base_km);\n                      let fee = parseFloat(((parseInt(this.vehicles[i].base_km) * parseInt(this.vehicles[i].base_fare)) + (extraKm * parseInt(this.vehicles[i].per_km))).toFixed(2))\n                      this.vehicles[i].fee = fee;\n                      this.vehicles[i].fee_taxed = parseFloat((fee + (fee * (parseInt(this.vehicles[i].tax) / 100))).toFixed(2))\n                    }\n\n                    if (this.vehicles[i].commission_type == 'percentage') {\n                      this.vehicles[i].commission = parseFloat((this.vehicles[i].fee * (parseInt(this.vehicles[i].commission_value) / 100)).toFixed(2));\n                    }\n                    else {\n                      this.vehicles[i].commission = parseFloat(parseFloat(this.vehicles[i].commission_value).toFixed(2));\n                    }\n                  }\n\n                } else {\n                  console.log(\"error\");\n                }\n              });\n\n            }\n\n            // set first device as default\n            this.vehicles[0].active = true;\n            this.currentVehicle = this.vehicles[0];\n\n            this.locality = locality;\n            if (this.isTrackDriverEnabled)\n              this.trackDrivers();\n          });\n        }\n      });\n\n      // add destination to map\n      if (this.destination) {\n        this.destLatLng = new google.maps.LatLng(this.destination.location.lat, this.destination.location.lng);\n        var bounds = new google.maps.LatLngBounds();\n        bounds.extend(this.startLatLng);\n        bounds.extend(this.destLatLng);\n\n        mapx.fitBounds(bounds);\n        var request = {\n          origin: this.startLatLng,\n          destination: this.destLatLng,\n          travelMode: google.maps.TravelMode.DRIVING\n        };\n        directionsService.route(request, function (response, status) {\n          if (status == google.maps.DirectionsStatus.OK) {\n            console.log(response);\n            directionsDisplay.setDirections(response);\n            directionsDisplay.setMap(mapx);\n          } else {\n            console.log(\"error\");\n          }\n        });\n      }\n      // this.common.hideLoader();\n    }).catch((error) => {\n      // this.common.hideLoader();\n      console.log('Error getting location', error);\n    });\n  }\n  showPromoPopup() {\n    this.alertCtrl.create({\n      header: 'Enter Promo code',\n      inputs: [\n        { name: 'promocode', placeholder: 'Enter Promo Code', value: this.promocode }\n      ],\n      buttons: [\n        { text: 'Cancel' },\n        {\n          text: 'Apply',\n          handler: (data) => {\n            console.log(data.promocode);\n            // verifying promocode\n            let code = (data.promocode).toUpperCase();\n            this.db.list(\"promocodes\", ref => ref.orderByChild(\"code\").equalTo(code)).snapshotChanges().pipe(take(1)).subscribe((promocodes) => {\n              console.log(promocodes);\n              if (promocodes.length > 0) {\n                let promo: any = promocodes[0].payload.val();\n                this.promocode = promo.code;\n                this.discount = promo.discount;\n                this.tripService.setPromo(promo.code);\n                this.tripService.setDiscount(promo.discount);\n                this.common.showToast(promo.code + \" Applied with \" + promo.discount + \"% discount\");\n              }\n              else {\n                this.common.showToast(\"Invalid Promocode\");\n              }\n            });\n          }\n        }\n      ]\n    }).then(prompt => prompt.present());\n\n  }\n\n\n  // Show note popup when click to 'Notes to user'\n  showNotePopup() {\n    this.alertCtrl.create({\n      header: 'Dicas para o Técnico',\n      message: \"\",\n      inputs: [\n        { name: 'note', placeholder: 'Dicas' },\n      ],\n      buttons: [\n        { text: 'Cancela' },\n        {\n          text: 'Salva',\n          handler: data => {\n            this.note = data;\n            this.tripService.setNote(data);\n            console.log('Saved clicked');\n          }\n        }\n      ]\n    }).then(prompt => prompt.present());\n\n  };\n\n  // go to next view when the 'Book' button is clicked\n  book() {\n\n    this.locateDriver = true;\n\n\n    // guarda detalhes do técnico\n    this.tripService.setAvailableDrivers(this.activeDrivers);\n    this.tripService.setDistance(this.distance);\n    this.tripService.setFee(this.currentVehicle.fee);\n    this.tripService.setRawFee(this.currentVehicle.fee);\n    this.tripService.setFeeTaxed(this.currentVehicle.fee_taxed);\n    this.tripService.setIcon(this.currentVehicle.icon);\n    this.tripService.setNote(this.note);\n    this.tripService.setPromo(this.promocode);\n    this.tripService.setDiscount(this.discount);\n    this.tripService.setTax(this.currentVehicle.tax);\n    this.tripService.setCommissionType(this.currentVehicle.commission_type)\n    this.tripService.setCommissionValue(this.currentVehicle.commission_value)\n    this.tripService.setCommission(this.currentVehicle.commission)\n    // this.tripService.setPaymentMethod('');\n    this.drivers = this.tripService.getAvailableDrivers();\n    // ordena técnicos por avaliação e distancia\n    this.drivers = this.dealService.sortDriversList(this.drivers);\n\n    //aplica desconto\n    console.log(this.tripService.getDiscount());\n    if (this.tripService.getDiscount() != 0) {\n      console.log(this.tripService.getFee());\n\n      let feeAfterDiscount = this.tripService.getFee() - (this.tripService.getFee() * this.tripService.getDiscount() / 100);\n      this.tripService.setFee(parseFloat(feeAfterDiscount.toFixed(2)));\n\n      console.log(feeAfterDiscount.toFixed(2));\n\n      let feeTaxedAfterDiscount = feeAfterDiscount + (feeAfterDiscount * (this.tripService.getTax() / 100))\n\n      this.tripService.setFeeTaxed(parseFloat(feeTaxedAfterDiscount.toFixed(2)));\n      console.log(feeTaxedAfterDiscount.toFixed(2));\n    }\n\n\n    if (this.drivers) {\n      this.makeDeal(0);\n    }\n\n  }\n\n  makeDeal(index) {\n    let driver = this.drivers[index];\n    let dealAccepted = false;\n\n    if (driver) {\n      driver.status = 'Bidding';\n      this.dealService.getDriverDeal(driver.key).valueChanges().pipe(take(1)).subscribe((snapshot: any) => {\n        // if user is available\n        console.log(snapshot);\n        if (snapshot == null) {\n          // create a record\n          console.log(snapshot);\n          console.log(this.user);\n\n          this.dealService.makeDeal(\n            this.user.uid,\n            driver.key,\n            this.tripService.getOrigin(),\n            this.tripService.getDestination(),\n            this.tripService.getDistance(),\n            this.tripService.getFee(),\n            this.tripService.getCurrency(),\n            this.tripService.getNote(),\n            this.tripService.getPaymentMethod(),\n            this.tripService.getPromo(),\n            this.tripService.getDiscount(),\n            this.tripService.getTax(),\n            this.tripService.getFeeTaxed(),\n            this.tripService.getRawFee(),\n            this.tripService.getCommissionType(),\n            this.tripService.getCommissionValue(),\n            this.tripService.getCommission(),\n          ).then(() => {\n            let sub = this.dealService.getDriverDeal(driver.key).valueChanges().subscribe((snap: any) => {\n              // if record doesn't exist or is accepted\n              if (snap === null || snap.status != DEAL_STATUS_PENDING) {\n                sub.unsubscribe();\n\n                // if deal has been cancelled\n                if (snap === null) {\n                  this.nextDriver(index);\n                } else if (snap.status == DEAL_STATUS_ACCEPTED) {\n                  // if deal is accepted\n                  console.log('accepted', snap.tripId);\n                  dealAccepted = true;\n                  this.locateDriver = false;\n\n                  this.drivers = [];\n                  this.tripService.setId(snap.tripId);\n                  // go to user page\n                  this.router.navigateByUrl('tracking');\n                }\n              }\n            });\n          });\n        } else {\n          this.nextDriver(index);\n        }\n      });\n    } else {\n      // show error & try again button\n      console.log('No user found');\n      this.locateDriver = false;\n      this.common.showAlert(\"Nenhum técnico encontrado ou técnicos estão longe do seu endereço \");\n    }\n  }\n\n  // aciona o outro técnico\n  nextDriver(index) {\n    this.drivers.splice(index, 1);\n    this.makeDeal(index);\n  }\n\n  //seleciona o local do atendimento\n  chooseOrigin() {\n\n    this.router.navigate(['map'], {\n      queryParams: {\n        type: 'origin'\n      }\n    });\n  }\n\n  // choose destination place\n  chooseDestination() {\n    this.router.navigate(['map'], {\n      queryParams: {\n        type: 'destination'\n      }\n    });\n  }\n\n  choosePaymentMethod() {\n    this.router.navigateByUrl('/payments');\n  }\n\n  //adiciona local do atendimento ao mapa\n  setOrigin() {\n    // add origin and destination marker\n    let latLng = new google.maps.LatLng(this.origin.location.lat, this.origin.location.lng);\n    let startMarker = new google.maps.Marker({ map: this.map, position: latLng });\n    startMarker.setMap(this.map);\n    if (this.destination)\n      startMarker.setMap(null);\n    // set map center to origin address\n    this.map.setCenter(latLng);\n  }\n\n  // show or hide vehicles\n  toggleVehicles() {\n    this.showVehicles = !this.showVehicles;\n    this.showModalBg = (this.showVehicles == true);\n  }\n\n  // track drivers\n  trackDrivers() {\n    this.showDriverOnMap(this.locality);\n    clearInterval(this.driverTracking);\n\n    this.driverTracking = setInterval(() => {\n      this.showDriverOnMap(this.locality);\n    }, POSITION_INTERVAL);\n  }\n  // show drivers on map\n  showDriverOnMap(locality) {\n\n    console.log(\"Searching: \" + this.currentVehicle.id + \" under \" + locality);\n\n    this.driverService.getActiveDriver(locality, this.currentVehicle.id).valueChanges().pipe(take(1)).subscribe((snapshot: any) => {\n\n      // clear vehicles\n      this.clearDrivers();\n      if (snapshot != null) {\n        console.log(snapshot.length + \" Drivers\");\n        // only show near vehicle\n        snapshot.forEach(vehicle => {\n\n          let distance = this.placeService.calcCrow(vehicle.lat, vehicle.lng, this.origin.location.lat, this.origin.location.lng);\n\n          console.log(\"Distancia:\" + (distance < SHOW_VEHICLES_WITHIN) + \" última atividade:\" + (vehicle.last_active < VEHICLE_LAST_ACTIVE_LIMIT));\n\n          // checking last active time and distance\n          if (distance < SHOW_VEHICLES_WITHIN && Date.now() - vehicle.last_active < VEHICLE_LAST_ACTIVE_LIMIT) {\n            // create or update\n            let latLng = new google.maps.LatLng(vehicle.lat, vehicle.lng);\n\n            let marker = new google.maps.Marker({\n              map: this.map,\n              position: latLng,\n              icon: {\n                url: this.currentVehicle.map_icon,\n                size: new google.maps.Size(32, 32),\n                origin: new google.maps.Point(0, 0),\n                anchor: new google.maps.Point(16, 16),\n                scaledSize: new google.maps.Size(32, 32)\n              },\n            });\n\n            // add vehicle and marker to the list\n            vehicle.distance = distance;\n            this.driverMarkers.push(marker);\n            this.activeDrivers.push(vehicle);\n          } else {\n            console.log('Esse veiculo esta muito longe');\n          }\n\n        });\n      }\n    });\n  }\n\n  // clear expired drivers on the map\n  clearDrivers() {\n    this.activeDrivers = [];\n    this.driverMarkers.forEach((vehicle) => {\n      vehicle.setMap(null);\n    });\n  }\n\n}\n","import { Injectable } from '@angular/core';\nimport { DEAL_STATUS_PENDING } from 'src/environments/environment.prod';\nimport { AngularFireDatabase } from '@angular/fire/database';\nimport { AuthService } from './auth.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DealService {\n\n  constructor(private db: AngularFireDatabase, private authService: AuthService) {\n  }\n\n  // ordena os técnicos pela avaliação\n  sortDriversList(drivers: Array<any>) {\n    return drivers.sort((a, b) => {\n      return (a.rating - a.distance / 5) - (b.rating - b.distance / 5);\n    })\n  }\n\n  // make deal to driver\n  makeDeal(userId, driverId, origin, destination, distance, fee, currency, note, paymentMethod, promocode, discount, tax, fee_taxed, rawfee, commission_type, commission_value, commission) {\n    return this.db.object('deals/' + driverId).set({\n      passengerId: userId,\n      currency: currency,\n      origin: origin,\n      destination: destination,\n      distance: distance,\n      fee: fee,\n      note: note,\n      paymentMethod: paymentMethod,\n      status: DEAL_STATUS_PENDING,\n      createdAt: Date.now(),\n      promocode: promocode,\n      discount: discount,\n      tax: tax,\n      fee_taxed: fee_taxed,\n      rawfee: rawfee,\n      commission_type: commission_type,\n      commission_value: commission_value,\n      commission: commission\n    });\n  }\n\n  // get deal by driverId\n  getDriverDeal(driverId) {\n    return this.db.object('deals/' + driverId);\n  }\n\n  // remove deal\n  removeDeal(driverId) {\n    return this.db.object('deals/' + driverId).remove();\n  }\n}\n"]}